<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#07090c"/>
  <title>Viral Link</title>
  <style>
    :root{
      --bg:#07090c; --card:rgba(255,255,255,.06); --stroke:rgba(255,255,255,.12);
      --bio:#20ff9a; --cyan:#31d7ff; --pink:#ff2f6d; --gold:#ffd56a;
      --text:rgba(255,255,255,.92); --muted:rgba(255,255,255,.65);
      --r:22px; --pad:14px;
      --safeTop: env(safe-area-inset-top, 0px);
      --safeBottom: env(safe-area-inset-bottom, 0px);
      --shadow: 0 18px 60px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box} html,body{height:100%; margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{overflow:hidden; -webkit-tap-highlight-color:transparent; user-select:none}
    @media (min-width: 820px) and (min-height: 520px){
      body:before{
        content:"Mobile only. Open on phone (vertical).";
        position:fixed; inset:0; display:grid; place-items:center;
        background:#05070a; color:rgba(255,255,255,.8); font-weight:800; z-index:99999;
      }
    }

    /* Background */
    .bg{
      position:fixed; inset:0; overflow:hidden;
      background:
        radial-gradient(1100px 700px at 50% 0%, rgba(32,255,154,.15), transparent 55%),
        radial-gradient(900px 700px at 10% 50%, rgba(49,215,255,.12), transparent 55%),
        radial-gradient(1000px 700px at 90% 60%, rgba(255,47,109,.10), transparent 60%),
        linear-gradient(180deg, #05070a, #07090c 35%, #06070a);
    }
    .bg video{
      position:absolute; inset:-10%;
      width:120%; height:120%;
      object-fit:cover;
      opacity:.14;
      filter:saturate(1.1) contrast(1.05);
      pointer-events:none;
    }
    .noise{
      position:absolute; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.25'/%3E%3C/svg%3E");
      opacity:.06; mix-blend-mode:overlay; pointer-events:none;
    }

    /* App shell */
    .app{
      position:fixed; inset:0;
      display:flex; flex-direction:column;
      padding-top:calc(10px + var(--safeTop));
      padding-bottom:calc(10px + var(--safeBottom));
      gap:10px;
    }
    .top{
      padding: 0 var(--pad);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
    }
    .sigil{
      width:38px; height:38px; border-radius:14px;
      background:
        radial-gradient(circle at 30% 30%, rgba(32,255,154,.85), rgba(32,255,154,0) 60%),
        radial-gradient(circle at 70% 60%, rgba(49,215,255,.65), rgba(49,215,255,0) 60%),
        linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.16);
      box-shadow: var(--shadow);
      position:relative; overflow:hidden;
    }
    .sigil:after{
      content:""; position:absolute; inset:-60%;
      background: conic-gradient(from 210deg, rgba(32,255,154,0), rgba(32,255,154,.25), rgba(49,215,255,0), rgba(255,47,109,.18), rgba(32,255,154,0));
      filter: blur(8px);
      animation:spin 6s linear infinite;
      opacity:.95;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .title{font-weight:900; letter-spacing:.6px; font-size:14px}
    .sub{font-size:11px; color:var(--muted)}
    .pill{
      display:flex; align-items:center; gap:8px;
      padding:9px 12px; border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
    }
    .dot{width:10px; height:10px; border-radius:99px; background: radial-gradient(circle at 30% 30%, var(--bio), rgba(32,255,154,.25)); box-shadow: 0 0 18px rgba(32,255,154,.35)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; letter-spacing:.6px; font-size:11px}

    .panel{
      margin:0 var(--pad);
      border-radius: 28px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
      flex:1;
      display:flex;
      flex-direction:column;
    }

    .home{
      padding:14px;
      display:flex; flex-direction:column; gap:12px;
    }
    .hero{
      padding:16px;
      border-radius: 22px;
      background:
        radial-gradient(700px 260px at 20% 10%, rgba(32,255,154,.18), transparent 60%),
        radial-gradient(700px 260px at 80% 30%, rgba(49,215,255,.12), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.14);
    }
    .hero h1{margin:0 0 6px; font-size:18px}
    .hero p{margin:0; color:rgba(255,255,255,.72); font-size:12.5px; line-height:1.35}
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      font-size:12px;
    }

    .btn{
      border:none; outline:none; width:100%;
      padding: 14px 14px;
      border-radius: 18px;
      font-weight: 900;
      color: rgba(0,0,0,.92);
      background:
        radial-gradient(140% 140% at 20% 20%, rgba(255,255,255,.55), rgba(255,255,255,0) 38%),
        linear-gradient(90deg, rgba(32,255,154,1), rgba(49,215,255,1));
      box-shadow: 0 16px 40px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.20) inset, 0 0 40px rgba(32,255,154,.20);
      position:relative; overflow:hidden;
      transform: translateZ(0);
    }
    .btn:active{transform:scale(.985)}
    .btn.secondary{
      color:rgba(255,255,255,.92);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.12);
    }
    .btn.danger{
      color:rgba(255,255,255,.92);
      background: linear-gradient(90deg, rgba(255,47,109,1), rgba(255,144,99,1));
      box-shadow: 0 16px 40px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.16) inset, 0 0 40px rgba(255,47,109,.20);
    }
    .row2{display:grid; grid-template-columns:1fr 1fr; gap:10px}

    /* Game view */
    .gameWrap{flex:1; display:none; position:relative}
    #phaser{position:absolute; inset:0}
    .hud{
      position:absolute; left:12px; right:12px; top:12px;
      display:flex; gap:8px; z-index:5;
    }
    .hud .h{
      flex:1;
      padding:10px 12px;
      border-radius:16px;
      background: rgba(0,0,0,.32);
      border:1px solid rgba(255,255,255,.12);
      display:flex; justify-content:space-between; align-items:center;
      font-size:12px;
    }

    .bottom{
      padding: 10px var(--pad);
      display:flex; gap:10px;
      background: rgba(0,0,0,.10);
    }
    .navBtn{
      flex:1;
      padding: 12px 10px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.75);
      font-weight:900;
    }
    .navBtn.active{
      color: rgba(0,0,0,.90);
      background: linear-gradient(90deg, rgba(32,255,154,.95), rgba(49,215,255,.95));
    }
    .toast{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom: calc(84px + var(--safeBottom));
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(0,0,0,.70);
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 18px 50px rgba(0,0,0,.55);
      opacity:0; transition:.18s;
      z-index:9999; max-width: 92vw;
      font-size:12px;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-4px)}
  </style>
</head>
<body>
  <div class="bg">
    <video autoplay muted loop playsinline webkit-playsinline>
      <source src="assets/intro.mp4" type="video/mp4"/>
    </video>
    <div class="noise"></div>
  </div>

  <div class="app">
    <div class="top">
      <div class="brand">
        <div class="sigil"></div>
        <div>
          <div class="title">VIRAL LINK</div>
          <div class="sub">Infect ‚Ä¢ Rise ‚Ä¢ Rule</div>
        </div>
      </div>
      <div class="pill">
        <div class="dot"></div>
        <div style="font-size:11px; color:var(--muted)">ID</div>
        <div class="mono" id="myId">‚Äî</div>
      </div>
    </div>

    <div class="panel">
      <div class="home" id="home">
        <div class="hero">
          <h1>–¢–≤–æ—è —Å—Å—ã–ª–∫–∞ ‚Äî –≤–∏—Ä—É—Å.</h1>
          <p>–ò–≥—Ä–æ–∫ –∑–∞—Ö–æ–¥–∏—Ç –ø–æ —Ç–≤–æ–µ–π —Å—Å—ã–ª–∫–µ ‚Üí —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å +1 –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–µ. –í –∏–≥—Ä–µ –∑–∞—Ä–∞–∂–∞–π –ª—é–¥–µ–π ‚Äî —ç—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç —Ä–æ—Å—Ç.</p>
          <div class="chips" style="margin-top:12px">
            <span class="chip"><span class="mono">REF</span> <b id="refLabel">‚Äî</b></span>
            <span class="chip"><span class="mono">INFECTED</span> <b id="infected">0</b></span>
            <span class="chip"><span class="mono">FROM</span> <b class="mono" id="from">‚Äî</b></span>
          </div>
        </div>

        <button class="btn" id="play">–ò–ì–†–ê–¢–¨ ‚Ä¢ –ó–ê–†–ê–ñ–ê–¢–¨</button>

        <div class="row2">
          <button class="btn secondary" id="copy">Copy Link</button>
          <button class="btn secondary" id="share">Share</button>
        </div>

        <div class="row2">
          <button class="btn secondary" id="skins">Skins</button>
          <button class="btn secondary" id="rank">Leaderboard</button>
        </div>

        <button class="btn danger" id="chat">GLOBAL CHAT (Telegram)</button>
      </div>

      <div class="gameWrap" id="gameWrap">
        <div class="hud">
          <div class="h"><b>Score</b><span class="mono" id="score">0</span></div>
          <div class="h"><b>Combo</b><span class="mono" id="combo">x1</span></div>
          <div class="h"><b>Streak</b><span class="mono" id="streak">0</span></div>
        </div>
        <div id="phaser"></div>
      </div>

      <div class="bottom">
        <button class="navBtn active" id="navHome">Home</button>
        <button class="navBtn" id="navPlay">Play</button>
        <button class="navBtn" id="navChat">Chat</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script src="https://unpkg.com/phaser@3.70.0/dist/phaser.min.js"></script>
  <script>
    // --- tiny utils
    const $ = (id)=>document.getElementById(id);
    function toast(msg, ms=1400){
      const t=$("toast"); t.textContent=msg; t.classList.add("show");
      clearTimeout(toast._t); toast._t=setTimeout(()=>t.classList.remove("show"), ms);
    }
    const urlRe = /https?:\/\/[^\s]+|www\.[^\s]+|\b[\w.-]+\.[a-z]{2,}\b/ig;

    // --- state
    const KEY="vl_simple_v1";
    const SKINS=[
      {id:"classic", src:"assets/skins/classic.png"},
      {id:"neon", src:"assets/skins/neon.png"},
      {id:"toxic", src:"assets/skins/toxic.png"},
      {id:"void", src:"assets/skins/void.png"},
      {id:"gold", src:"assets/skins/gold.png"},
    ];
    function genId(){ const a="ABCDEFGHJKLMNPQRSTUVWXYZ23456789"; let o=""; for(let i=0;i<8;i++) o+=a[(Math.random()*a.length)|0]; return o; }
    function load(){
      try{ const s=JSON.parse(localStorage.getItem(KEY)||"null"); if(s?.me?.id) return s; }catch(e){}
      const s={ me:{ id:genId(), skin:"classic", infectedBy:null, infected:0 }, players:{} };
      s.players[s.me.id]={infected:0};
      localStorage.setItem(KEY, JSON.stringify(s));
      return s;
    }
    function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
    const state = load();

    // referral
    const u=new URL(location.href);
    const ref=u.searchParams.get("ref");
    if(ref && ref!==state.me.id && !state.me.infectedBy){
      state.me.infectedBy=ref;
      state.players[ref]=state.players[ref]||{infected:0};
      state.players[ref].infected++;
      save();
      toast("–ó–∞—Ä–∞–∂—ë–Ω –æ—Ç: "+ref);
    }

    function myRef(){
      const base=location.origin+location.pathname;
      return `${base}?ref=${encodeURIComponent(state.me.id)}`;
    }

    // UI render
    function render(){
      $("myId").textContent=state.me.id;
      $("refLabel").textContent="?ref="+state.me.id;
      $("infected").textContent=String(state.players[state.me.id]?.infected||0);
      $("from").textContent=state.me.infectedBy||"‚Äî";
    }
    render();

    // nav
    function showHome(){
      $("home").style.display="flex";
      $("gameWrap").style.display="none";
      $("navHome").classList.add("active");
      $("navPlay").classList.remove("active");
      $("navChat").classList.remove("active");
    }
    function showGame(){
      $("home").style.display="none";
      $("gameWrap").style.display="block";
      $("navHome").classList.remove("active");
      $("navPlay").classList.add("active");
      $("navChat").classList.remove("active");
      startGameOnce();
    }
    function openChat(){
      $("navHome").classList.remove("active");
      $("navPlay").classList.remove("active");
      $("navChat").classList.add("active");
      // üëâ —Å—é–¥–∞ –≤—Å—Ç–∞–≤–∏—à—å —Å–≤–æ—é –≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª
      const tg = "https://t.me/your_group_here";
      window.open(tg, "_blank");
    }

    $("navHome").onclick=showHome;
    $("navPlay").onclick=showGame;
    $("navChat").onclick=openChat;

    $("play").onclick=showGame;
    $("chat").onclick=openChat;

    $("copy").onclick=async ()=>{
      await navigator.clipboard.writeText(myRef());
      toast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ");
    };
    $("share").onclick=async ()=>{
      const link=myRef();
      if(navigator.share){
        try{ await navigator.share({title:"Viral Link", text:"–ó–∞–π–¥–∏ –ø–æ —Å—Å—ã–ª–∫–µ ‚Äî —Ç—ã –∑–∞—Ä–∞–∂—ë–Ω üòà", url:link}); toast("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"); }
        catch(e){ await navigator.clipboard.writeText(link); toast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ"); }
      }else{
        await navigator.clipboard.writeText(link); toast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ");
      }
    };

    $("skins").onclick=()=>{
      // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ: —Ü–∏–∫–ª–∏–º —Å–∫–∏–Ω
      const i=SKINS.findIndex(s=>s.id===state.me.skin);
      state.me.skin=SKINS[(i+1)%SKINS.length].id;
      save();
      toast("Skin: "+state.me.skin);
    };

    $("rank").onclick=()=>{
      // –¥–µ–º–æ-–ª–∏–¥–µ—Ä–±–æ—Ä–¥ (–ª–æ–∫–∞–ª—å–Ω–æ): –∫—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ—Ö ‚Äúinfected‚Äù
      const arr=Object.entries(state.players).map(([id,v])=>({id, infected:v.infected||0}));
      arr.sort((a,b)=>b.infected-a.infected);
      const top=arr.slice(0,5).map((x,i)=>`#${i+1} ${x.id}: ${x.infected}`).join(" | ");
      toast(top, 2600);
    };

    // ---- Phaser game (simple + addictive)
    let started=false;
    let game=null;

    function startGameOnce(){
      if(started) return;
      started=true;

      const cfg={
        type: Phaser.AUTO,
        parent: "phaser",
        backgroundColor: "rgba(0,0,0,0)",
        scale:{
          mode: Phaser.Scale.RESIZE,
          autoCenter: Phaser.Scale.CENTER_BOTH,
          width: window.innerWidth,
          height: window.innerHeight,
        },
        physics:{ default:"arcade", arcade:{ gravity:{y: 1100}, debug:false } },
        scene:{ preload, create, update }
      };
      game = new Phaser.Game(cfg);
    }

    function preload(){
      // skins
      for(const s of SKINS) this.load.image("skin_"+s.id, s.src);
      this.load.image("human", "assets/humans/human.png");
      this.load.image("elite", "assets/humans/human_elite.png");
    }

    function create(){
      const W=this.scale.width, H=this.scale.height;
      this.groundY = Math.floor(H*0.80);

      // subtle parallax stripes
      this.bgG = this.add.graphics();
      const drawBG = ()=>{
        this.bgG.clear();
        this.bgG.fillStyle(0x000000, 0.22);
        this.bgG.fillRoundedRect(14, 14, W-28, H-28, 22);
        this.bgG.lineStyle(2, 0xffffff, 0.06);
        this.bgG.strokeRoundedRect(14, 14, W-28, H-28, 22);
        this.bgG.lineStyle(2, 0x20ff9a, 0.07);
        this.bgG.strokeCircle(W*0.25, H*0.35, Math.min(W,H)*0.42);
        this.bgG.lineStyle(2, 0x31d7ff, 0.07);
        this.bgG.strokeCircle(W*0.75, H*0.62, Math.min(W,H)*0.36);
      };
      drawBG();
      this.scale.on("resize", ()=>drawBG());

      // player
      this.player = this.physics.add.sprite(W*0.22, this.groundY, "skin_"+state.me.skin);
      this.player.setDisplaySize(86,86);
      this.player.setCollideWorldBounds(true);
      this.player.body.setSize(40,40,true);
      this.player.setDepth(2);

      // floor (invisible)
      this.floor = this.physics.add.staticImage(W/2, this.groundY+70, null);
      this.floor.displayWidth = W;
      this.floor.displayHeight = 10;
      this.floor.refreshBody();

      // humans group
      this.humans = this.physics.add.group();
      this.spawnT=0;

      // score
      this.score=0; this.combo=1; this.comboT=0; this.streak=0; this.level=1;

      // particles (simple)
      this.p = this.add.particles(0xffffff);
      this.em = this.p.createEmitter({
        speed: {min:80, max:240},
        lifespan: {min:250, max:520},
        quantity: 0,
        scale: {start:0.6, end:0},
        alpha: {start:0.35, end:0},
        blendMode: "ADD"
      });

      // collision: infect
      this.physics.add.overlap(this.player, this.humans, (pl, hu)=>{
        if(hu.hit) return;
        hu.hit=true;
        const add = hu.isElite ? 3 : 1;
        this.score += add * this.combo;
        this.combo = Math.min(12, this.combo + (hu.isElite?2:1));
        this.comboT = 70;

        this.em.explode(24 + add*6, hu.x, hu.y);
        hu.destroy();

        // level / streak
        const target = this.level * 55;
        if(this.score >= target){
          this.level++; this.streak++;
          this.em.explode(44, pl.x+30, pl.y-10);
        }

        $("score").textContent = this.score;
        $("combo").textContent = "x"+this.combo;
        $("streak").textContent = this.streak;
      });

      // input: tap jump / hold dash
      let hold=null;
      this.input.on("pointerdown", ()=>{
        hold=setTimeout(()=>{
          // dash = speed boost via velocity
          this.player.setVelocityX(260);
          this.time.delayedCall(120, ()=>this.player.setVelocityX(0));
        }, 130);
      });
      this.input.on("pointerup", ()=>{
        if(hold){ clearTimeout(hold); hold=null; }
        if(this.player.y >= this.groundY-2){
          this.player.setVelocityY(-520);
        }
      });

      // cleanup if skin changes while game is running
      this.events.on("resume", ()=>{
        this.player.setTexture("skin_"+state.me.skin);
      });
    }

    function update(time, dt){
      const W=this.scale.width, H=this.scale.height;
      const speed = 260 + Math.min(420, time/14);

      // keep player on ground
      if(this.player.y > this.groundY) this.player.y=this.groundY;

      // spawn humans
      this.spawnT += dt;
      if(this.spawnT > 520 - Math.min(280, time/10)){
        this.spawnT = 0;
        const elite = Math.random() < 0.16;
        const y = this.groundY - 18 - Math.random()*60;
        const x = W + 120 + Math.random()*260;
        const hu = this.humans.create(x, y, elite ? "elite" : "human");
        hu.setDisplaySize(elite?66:58, elite?66:58);
        hu.body.setSize(32,32,true);
        hu.setVelocityX(-speed);
        hu.isElite = elite;
        hu.hit = false;
      }

      // despawn out of screen
      this.humans.children.each((hu)=>{
        if(hu && hu.x < -140) hu.destroy();
      });

      // combo decay
      if(this.comboT>0) this.comboT -= 1;
      else this.combo = Math.max(1, this.combo-1);

      // end run after ~45 sec: reward infected count (demo)
      if(time > 45000){
        // reward: every 20 score = +1 infected
        const bonus = Math.floor(this.score/20);
        if(bonus>0){
          state.players[state.me.id] = state.players[state.me.id] || {infected:0};
          state.players[state.me.id].infected += bonus;
          save(); render();
          toast("Run bonus +"+bonus+" to INFECTED", 2200);
        }
        // reset
        this.scene.restart();
      }

      // update skin live
      const want = "skin_"+state.me.skin;
      if(this.player.texture?.key !== want) this.player.setTexture(want);
    }
  </script>
</body>
</html>
